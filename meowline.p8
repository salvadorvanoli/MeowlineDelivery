pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- variables del jugador
-- Actualiza la posiciれはn inicial del jugador para que estれた cerca del suelo
player = {
    x = 64,
    y = 80,
    dx = 0,
    dy = 0,
    w = 16,
    h = 16,
    grounded = false,
    der = true
}

-- gravedad y velocidad
gravity = 0.3
jump_power = -5
move_speed = 2

-- plataformas
platforms = {
--    {x = 0, y = 96, w = 1020, h = 8}, -- plataforma larga
}

-- Indice del sprite solido (suelo)
solid_sprite = 2

-- funcion para verificar colision con el mapa
-- Mejora la funciれはn de verificaciれはn de colisiones
function check_map_collision(x, y, w, h)
    -- Asegれむrate de que los valores sean nれむmeros
    x = flr(x)
    y = flr(y)
    
    -- Calcula los rangos de celdas a verificar
    local start_cx = flr(x / 8)
    local end_cx = flr((x + w - 1) / 8)
    local start_cy = flr(y / 8)
    local end_cy = flr((y + h - 1) / 8)

    -- Iterar sobre las celdas del mapa
    for cx = start_cx, end_cx do
        for cy = start_cy, end_cy do
            -- Debug: imprime informaciれはn sobre las celdas que compruebas
            -- print("Checking cell: "..cx..","..cy.." = "..mget(cx,cy))
            if mget(cx, cy) == solid_sprite then
                return true, cy * 8
            end
        end
    end

    return false
end

-- funcion para dibujar
function _draw()
    cls()

    -- dibujar el mapa
    map(0, 0, 0, 0, 128, 128)

    -- centrar la camara en el jugador
    local cam_x = mid(0, player.x - 64, 1024 - 128) -- ajustar lれとmites del mapa
    local cam_y = mid(0, player.y - 64, 256 - 128)
    camera(cam_x, cam_y)

    -- dibujar jugador (sprite del gato)
    spr(0, player.x, player.y, 2, 2, player.der) -- usa el sprite 0, tamaれねo 2x2

    -- dibujar plataformas
    for p in all(platforms) do
        rectfill(p.x, p.y, p.x + p.w, p.y + p.h, 6)
    end

    -- Dibuja el area de colisiれはn
    -- rect(player.x, player.y + player.h, player.x + player.w, player.y + player.h + 1, 8)
end

-- funcion para actualizar
function _update()
    -- movimiento horizontal
    if btn(0) then -- izquierda
        player.dx = -move_speed
        player.der = false
    elseif btn(1) then -- derecha
        player.dx = move_speed
        player.der = true
    else
        player.dx = 0
    end

    -- salto
    if btnp(4) and player.grounded then
        player.dy = jump_power
        player.grounded = false
    end

    -- aplicar gravedad
    player.dy += gravity

    -- actualizar posicion
    player.x += player.dx
    player.y += player.dy

    -- verificar colision con el suelo
    player.grounded = false
    local collided, ground_y = check_map_collision(player.x, player.y + player.h, player.w, 1)
    if collided and player.dy >= 0 then
        player.y = ground_y - player.h -- ajusta la posicion del jugador
        player.dy = 0
        player.grounded = true
    end

    -- evitar salir de los limites del mapa
    if player.x < 0 then player.x = 0 end
    if player.x + player.w > 1024 then player.x = 1024 - player.w end
    if player.y > 256 then player.y = 256 end
end
__gfx__
0000000000000000dddddddd11111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000dd1dd1dd15551115000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000d11d11d111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001111111151115551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06006000000000001111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
67776000000000001111111115551115000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
63737000000000001111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
67676000000000001111111151115551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06776677000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07776666700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06766666670070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06665667775700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555077767000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05005007665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06006066650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000002020202020000000000000000030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003030303030000020202020000030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003030303030000030303030000030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003030303030000030303030000030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003030303030000030303030000030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
